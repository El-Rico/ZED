TARGET = libZED$(ZEDTARGET).a

PLATFORM = LINUX32_X86

NOLIB ?= False
COPYHEADERS ?= True

COMMONINCDIR = ../../Common/Headers

CC = g++

CFLAGS_EXT =
ifeq ($(PLATFORM), LINUX32_X86)
	CFLAGS_EXT = -ffriend-injection
endif

ifeq ($(PLATFORM), OSX)
	CFLAGS_EXT = -fvisibility-inlines-hidden
endif

ifeq ($(PLATFORM), MinGW)
	CFLAGS_EXT = -DGLEW_STATIC
endif

####### Release Targets #########
release: BUILD = Release
release: CFLAGS = -c -O $(CFLAGS_EXT)
ifneq ($(NOLIB), True)
release: $(TARGET)
endif
ifeq ($(COPYHEADERS), True)
release: copyheaders
endif

####### Debug Targets ############
debug: BUILD = Debug
debug: CFLAGS = -c -g -D_DEBUG $(CFLAGS_EXT)
ifneq ($(NOLIB), True)
debug: $(TARGET)
endif
ifeq ($(COPYHEADERS), True)
debug: copyheaders
endif

####### Profile Targets ##########
profile: BUILD = Profile
profile: CFLAGS = -c -O $(CFLAGS_EXT)
ifneq ($(NOLIB), True)
profile: $(TARGET)
endif
ifeq ($(COPYHEADERS), True)
profile: copyheaders
endif

###### Set based on build type ##############
COMMONDIR ?= ../../../

TARGETDIR = $(COMMONDIR)Lib/$(PLATFORM)/$(BUILD)
OBJSDIR = $(COMMONDIR)Obj/$(PLATFORM)/$(BUILD)
HEADERSDIR = $(COMMONDIR)Includes$(TAREGETSUFFIX)

ifeq ($(PLATFORM), Linux)
	SYSIPATH = -I/usr/include/xorg
else
	SYSIPATH =
endif

$(OBJSDIR):
	-mkdir -p $(OBJSDIR)
$(TARGETDIR):
	-mkdir -p $(TARGETDIR)

#####################
OBJS = $(patsubst %.cpp,%.o,$(wildcard *.cpp ))
HEADERS = $(wildcard *.hpp)
#####################

ifneq ($(NOLIB), True)

$(TARGET): $(OBJS) $(TARGETDIR)
	cd $(OBJSDIR) && ar rc $(TARGETDIR)/$(TARGET) $(OBJS)
	ranlib $(TARGETDIR)/$(TARGET)
	
%.o: %.cpp $(OBJSDIR)
	$(CC) $(CFLAGS) -DZED_PLATFORM_$(PLATFORM) -I$(COMMONINCDIR) $(ZEDINCDIR) $(SYSIPATH) $< -o $(OBJSDIR)/$@

endif

#####################
ifeq ($(COPYHEADERS), True)
.PHONY: copyheaders
endif
#####################
copyheaders:
	mkdir -p $(HEADERSDIR)
#	cp -f $(ZEDINCDIR)/*.hpp $(HEADERSDIR)
	cp -f $(COMMONINCDIR)/*.hpp $(HEADERSDIR)

.PHONY: clean
clean:
	-cd $(COMMONDIR)Lib/$(PLATFORM)/Release && rm -f $(OBJS)
	-cd .. && cd Lib && cd $(PLATFORM)/Release && rm -f $(TARGET)
	-cd $(PLATFORM)/Debug && rm -f $(OBJS)
	-cd .. && cd Lib && cd $PLATFORM)/Debug && rm -f $(TARGET)
	-cd $(PLATFORM)/Profile && rm -f $(OBJS)
	-cd .. && cd Lib && cd $PLATFORM)/Profile && rm -f $(TARGET)
	-cd .. && cd Includes && rm -f $(HEADERSDIR)
